{
rm(list = ls())
source("scripts/Sources.R")
}
tree_no3rd <- read.nexus("phylogeny/210315_DataS4-tree.tre")
# drop outgroup
label <- tree_no3rd$tip.label
out.group <- is.na(str_locate(label, "Ter")[,1] | str_locate(label, "ter")[,1])
termite.tree <- drop.tip(tree_no3rd, label[out.group])
termite.tree <- ladderize(termite.tree)
# fix errors in the label names
label<- termite.tree$tip.label
label[label=="Coptotermes_priscus"] <-  "Coptotermes_priscus_fossil"
label <- str_replace(label, "Homalotermes", "Homallotermes")
termite.tree$tip.label <- label
# drop fossil species
fossil <- !is.na(str_locate(label, "fossil")[,1])
termite.tree <- drop.tip(termite.tree, label[fossil])
# drop Havilanditermes (synonym to Nasutitermes)
termite.tree <- drop.tip(termite.tree, "Havilanditermes_atripennis")
# label name = genus name
label<- termite.tree$tip.label
label <- str_replace(label, "_.*", "")
termite.tree$tip.label <- label
plot(termite.tree, cex = 0.3)
d.all <- read.xlsx("data_raw/Genus-level_data.xlsx", sheet = 1)
d.all.ec <- read.xlsx("data_raw/Genus-level_data.xlsx", sheet = 2)
d.exclude_ambiguous <- read.xlsx("data_raw/Genus-level_data.xlsx", sheet = 3)
# Reduce data to match phylogeny ----
termite.tree <- drop.tip(termite.tree, label[!(label %in% d.all$Genus)])
plot(termite.tree, cex=0.35)
d.cubi_sp <- d.all %>%
mutate(
Soldier_str = if_else(Sub.Family == "Cubitermitinae", 1, Soldier_str),
Soldier_str_string = if_else(Sub.Family == "Cubitermitinae", "Strong-point", Soldier_str_string)
)
# save output data ----
{
save(d.all, file = "data_fmt/Data_tree_genera.Rdata")
save(termite.tree, file = "data_fmt/Termite_tree.Rdata")
save(d.cubi_sp, file = "data_fmt/Data_tree_genera_cubisp.Rdata")
}
#if use entire colony data ----
# Reduce data to match phylogeny
{
d.tree.ec <- NULL
label<- termite.tree$tip.label
for(i in 1:length(label)){
Genus <- label[i]
d.tree.ec <- rbind(d.tree.ec, d.all.ec[d.all.ec$Genus == Genus,])
}
row.names(d.tree.ec) <- 1:dim(d.tree.ec)[1]
}
termite.tree.ec <- drop.tip(termite.tree, label[!(label %in% d.tree.ec$Genus)])
plot(termite.tree.ec, cex=0.35)
# save output data ----
{
save(d.tree.ec, file = "data_fmt/Data_tree_genera_ec.Rdata")
save(termite.tree.ec, file = "data_fmt/Termite_tree_ec.Rdata")
}
#####exclude all ambiguous genera#####
{
d.tree.aex <- NULL
label<- termite.tree$tip.label
for(i in 1:length(label)){
Genus <- label[i]
d.tree.aex <- rbind(d.tree.aex, d.exclude_ambiguous[d.exclude_ambiguous$Genus == Genus,])
}
row.names(d.tree.aex) <- 1:dim(d.tree.aex)[1]
}
termite.tree.aex <- drop.tip(termite.tree, label[!(label %in% d.tree.aex$Genus)])
plot(termite.tree.aex, cex=0.35)
{
save(d.tree.aex, file = "data_fmt/Data_all_exclude.Rdata")
save(termite.tree.aex, file = "data_fmt/Termite_tree_all_exclude.Rdata")
}
View(d.all)
## dependencies
{
rm(list = ls())
source("scripts/sources.R")
load("data_fmt/Data_tree_genera.Rdata")
load("data_fmt/Termite_tree.Rdata")
##load divided data
load("data_fmt/Data_tree_genera_ec.Rdata")
load("data_fmt/Termite_tree_ec.Rdata")
#assuming all Cubitermitinae are strong-point strategists
load("data_fmt/Data_tree_genera_cubisp.Rdata")
#all ambiguous genera excluded
load("data_fmt/Data_all_exclude.Rdata")
load("data_fmt/Termite_tree_all_exclude.Rdata")
d.all <- d.all%>%
mutate(investment = Sol_size_to_imago*Soldier_prop)
}
##
{
# summary of the num of genera for foraging and defense strategies
print( table(d.all[,c("Forager_string", "Soldier_str_string")]) )
print( table(d.all[,c("Forager", "Soldier_str")]) )
print( table(d.all[,c("Forager", "Soldier_str")]) )
}
View(termite.tree)
# Phylogenetic Analysis for proportion of soldier -----------------------
# ----- Phyloglm (soldier strategy vs proportion of soldier)  -----
d.sol.str.glm <- d.all
row.names(d.sol.str.glm) <- d.all$Genus
View(d.sol.str.glm)
#####Phylogenetic Analysis for proportion of soldier (robust dataset)
d.ec.glm <- d.tree.ec %>%
rename(sol_str = 8)
row.names(d.ec.glm) <- d.ec.glm$Genus
View(d.ec.glm)
#####Phylogenetic Analysis for proportion of soldier (robust dataset)
d.ec.glm <- d.tree.ec
View(d.ec.glm)
View(d.ec.glm)
#####Phylogenetic Analysis for proportion of soldier (robust dataset)
d.ec.glm <- d.tree.ec %>%
rename(sol_str = 8)
View(d.ec.glm)
View(d.all)
#####Phylogenetic Analysis for proportion of soldier (robust dataset)
d.ec.glm <- d.tree.ec
row.names(d.ec.glm) <- d.ec.glm$Genus
View(d.ec.glm)
r <- phyloglm(Sol_str ~ Soldier_prop,
phy=termite.tree.ec,
data = d.ec.glm,
boot = 1000, method = c("logistic_MPLE"))
View(d.ec.glm)
r <- phyloglm(Soldier_str ~ Soldier_prop,
phy=termite.tree.ec,
data = d.ec.glm,
boot = 1000, method = c("logistic_MPLE"))
summary(r)
# ----- Phyloglm if all Cubitermitinae were strong-point strategist  -----
d.cubi.glm <- d.cubi_sp
View(d.cubi.glm)
row.names(d.cubi.glm) <- d.cubi.glm$Genus
r <- phyloglm(soldier_str ~ Soldier_prop,
phy=termite.tree,
data = d.cubi.glm,
boot = 1000, method = c("logistic_MPLE"))
View(d.cubi.glm)
# ----- Phyloglm if all Cubitermitinae were strong-point strategist  -----
d.cubi.glm <- d.cubi_sp
row.names(d.cubi.glm) <- d.cubi.glm$Genus
# ----- Phyloglm exclude all ambiguous genera -----
d.sol.str.glm <- d.tree.aex
row.names(d.sol.str.glm) <- d.tree.aex$Genus
View(d.sol.str.glm)
###### Phylogenetic Analysis for soldier investment -----------------------
# ----- Phyloglm (soldier strategy vs proportion of soldier * soldier size)  -----
d.sol.str.glm <- d.all %>%
drop_na(sol_size_to_imago)
###### Phylogenetic Analysis for soldier investment -----------------------
# ----- Phyloglm (soldier strategy vs proportion of soldier * soldier size)  -----
d.sol.str.glm <- d.all %>%
drop_na(Sol_size_to_imago)
View(d.sol.str.glm)
row.names(d.sol.str.glm) <- d.sol.str.glm$Genus
tips_to_drop <- setdiff(termite.tree$tip.label, rownames(d.sol.str.glm))
termite.tree.solsize <- drop.tip(termite.tree, tips_to_drop)
r <- phyloglm(Soldier_str ~ investment,
phy=termite.tree.solsize,
data = d.sol.str.glm,
boot = 1000, method = c("logistic_MPLE"))
summary(r)
View(d.ec.glm)
d <- read.xlsx("data_raw/Species-level_data.xlsx", sheet = 1) #load species level data
